<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Loja • Mobile</title>
<style>
  :root{
    --bg:#0f1220; --bg2:#0a0e1c; --card:#11162a; --line:#1f2643;
    --text:#f7f8ff; --muted:#9aa3c1; --price:#6ee7b7; --btn:#34d399;
    --badge:#f59e0b; --ring:rgba(110,231,183,.35);
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--text);
       font:500 15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
  .wrap{max-width:980px;margin:18px auto;padding:0 14px}

  header{display:flex;align-items:center;justify-content:center;margin-bottom:6px}
  header h1{font-size:22px;margin:6px 0 2px}
  header p{margin:0;color:var(--muted);font-size:13px;text-align:center}

  /* busca (lupa) */
  .search{position:relative;margin:10px 0 8px}
  .search input{
    width:100%; background:#0d1226; color:var(--text); border:1px solid var(--line);
    border-radius:999px; padding:12px 44px 12px 40px; outline:none; transition:.2s;
    box-shadow:0 0 0 0 var(--ring);
  }
  .search input:focus{box-shadow:0 0 0 6px var(--ring); border-color:transparent}
  .search svg{position:absolute;left:12px;top:50%;transform:translateY(-50%);opacity:.8}
  .clear{position:absolute;right:8px;top:50%;transform:translateY(-50%);
    background:transparent;border:0;color:var(--muted);font-size:18px;padding:6px 10px;cursor:pointer}

  /* lista vertical */
  .carousel{position:relative}
  .track{
    display:grid; grid-auto-flow:row; grid-auto-rows:auto; gap:14px;
    overflow-y:auto; scroll-snap-type:y mandatory; padding:2px 2px 10px; max-height:68vh;
  }
  .card{scroll-snap-align:start;background:var(--card);border:1px solid var(--line);
        border-radius:16px;padding:12px;display:flex;flex-direction:column;gap:10px;
        box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .thumb{position:relative;border-radius:12px;overflow:hidden;background:#0b0f24;height:220px;touch-action:pan-y}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block;cursor:zoom-in}
  .badge{position:absolute;left:8px;top:8px;background:var(--badge);color:#2b1700;font-size:12px;font-weight:900;padding:4px 8px;border-radius:999px}

  /* setas das fotos (no card) */
  .nav{position:absolute;top:50%;transform:translateY(-50%);width:36px;height:36px;border-radius:999px;
       border:1px solid #ffffff33;background:#0006;color:#fff;display:flex;align-items:center;justify-content:center;
       font-size:18px;cursor:pointer;user-select:none}
  .nav:hover{background:#0008}
  .nav.prev{left:8px} .nav.next{right:8px}
  .counter{position:absolute;right:8px;bottom:8px;background:#0009;color:#fff;font-size:12px;font-weight:700;padding:2px 8px;border-radius:999px}

  h3{margin:0;font-size:16px;line-height:1.25;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  .muted{color:var(--muted);font-size:12px}
  .desc{color:var(--muted);font-size:13px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  .price{color:var(--price);font-weight:900;font-size:18px}
  .old{color:#a3a3a3;text-decoration:line-through;font-size:12px;margin-left:6px}
  .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 12px;border-radius:12px;border:1px solid transparent;background:var(--btn);color:#052015;font-weight:900;text-decoration:none;cursor:pointer}
  .dots{display:flex;gap:6px;justify-content:center;margin-top:8px}
  .dot{width:6px;height:6px;border-radius:999px;background:#2a315f}
  .dot.active{background:var(--btn)}
  .empty{color:var(--muted);text-align:center;margin:18px 0}

  /* barra de checkout */
  .bar{position:sticky;bottom:0;left:0;right:0;background:rgba(10,14,28,.9);backdrop-filter:blur(6px);
       border-top:1px solid var(--line);padding:10px 14px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .bar .sum{font-weight:800}
  .bar .left{display:flex;flex-direction:column;gap:6px}

  /* pagamento (pílulas) */
  .pay{display:flex;gap:6px;flex-wrap:wrap}
  .pill{position:relative}
  .pill input{position:absolute;opacity:0;pointer-events:none}
  .pill span{
    display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #2a315f;
    background:transparent;color:var(--text);font-weight:800;cursor:pointer;font-size:13px
  }
  .pill input:checked + span{background:var(--btn);color:#052015;border-color:transparent}

  /* BOTÃO ADM (flutuante no cantinho) */
  .adm-btn{
    position:fixed; right:14px; bottom:16px; z-index:1000;
    width:48px; height:48px; border-radius:999px;
    border:1px solid #2a315f;
    background:linear-gradient(90deg,var(--price),var(--btn));
    color:#052015; font-weight:900; letter-spacing:.5px;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
    cursor:pointer;
  }

  /* ====== VIEWER (lightbox) ====== */
  .viewer{position:fixed; inset:0; background:rgba(0,0,0,.85); display:none;
          align-items:center; justify-content:center; z-index:9999;}
  .viewer.show{display:flex}
  .viewer img{max-width:96vw; max-height:86vh; border-radius:12px; box-shadow:0 20px 50px rgba(0,0,0,.5); cursor:zoom-out}
  .vclose,.vprev,.vnext{
    position:absolute; width:44px; height:44px; border-radius:999px; border:1px solid #ffffff33;
    background:#0008; color:#fff; display:flex; align-items:center; justify-content:center;
    font-size:22px; cursor:pointer; user-select:none
  }
  .vclose{top:14px; right:14px}
  .vprev{left:16px; top:50%; transform:translateY(-50%)}
  .vnext{right:16px; top:50%; transform:translateY(-50%)}
  .vcount{position:absolute; bottom:14px; left:50%; transform:translateX(-50%);
          background:#0009; color:#fff; padding:4px 10px; border-radius:999px; font-weight:700; font-size:12px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1 id="nomeLoja">Maowire</h1>
        <p>Produtos com imagens embutidas no <code>produtos.js</code>.</p>
      </div>
    </header>

    <!-- dados -->
    <script src="produtos.js"></script>

    <!-- busca -->
    <div class="search" role="search" aria-label="buscar produtos">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M21 21l-4.2-4.2M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <input id="q" type="search" placeholder="Buscar produtos..." autocomplete="off" />
      <button id="clear" class="clear" title="Limpar" aria-label="limpar busca">×</button>
    </div>

    <!-- lista vertical -->
    <section class="carousel">
      <div id="track" class="track" aria-label="lista de produtos"></div>
      <div id="dots" class="dots"></div>
      <div id="empty" class="empty" style="display:none">Nenhum item encontrado.</div>
    </section>

    <!-- barra de checkout -->
    <div class="bar" id="bar" style="display:none">
      <div class="left">
        <div><span id="qtd">0</span> item(ns) • <span id="total" class="sum">R$ 0,00</span></div>
        <!-- FORMA DE PAGAMENTO -->
        <div class="pay" role="radiogroup" aria-label="Forma de pagamento">
          <label class="pill"><input type="radio" name="pg" value="PIX" checked><span>PIX</span></label>
          <label class="pill"><input type="radio" name="pg" value="Cartão"><span>Cartão</span></label>
          <label class="pill"><input type="radio" name="pg" value="Dinheiro"><span>Dinheiro</span></label>
        </div>
      </div>
      <button id="finalizar" class="btn">finalizar no WhatsApp</button>
    </div>
  </div>

  <!-- Botão flutuante ADM -->
  <button id="btnAdm" class="adm-btn" title="Área do administrador" aria-label="Área do administrador">ADM</button>

  <!-- Viewer (lightbox) -->
  <div id="viewer" class="viewer" role="dialog" aria-modal="true" aria-label="Visualizador de imagens">
    <button id="vClose" class="vclose" title="Fechar" aria-label="Fechar">×</button>
    <button id="vPrev"  class="vprev"  title="Anterior" aria-label="Anterior">‹</button>
    <img id="vImg" alt="Imagem do produto">
    <button id="vNext"  class="vnext"  title="Próxima" aria-label="Próxima">›</button>
    <div id="vCount" class="vcount"></div>
  </div>

<script>
  /* ===== Config ===== */
  const NOME_LOJA = 'Maowire';
  const numeroWA  = '559284977208';
  const AUTO_MS   = 10000;

  document.getElementById('nomeLoja').textContent = NOME_LOJA;

  // fallback para teste
  if (!Array.isArray(window.PRODUTOS)) {
    window.PRODUTOS = [{
      titulo:'Produto de Teste',
      preco:79.9,
      categoria:'Categoria',
      descricao:'Descrição de exemplo.',
      fotos:['data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=']
    }];
  }
  const produtosAll = window.PRODUTOS;

  /* ===== Estado ===== */
  let query = '';
  let carrinho = [];
  let autoTimer = null;
  let formaPagamento = 'PIX';

  /* ===== Util ===== */
  const fmt = new Intl.NumberFormat('pt-BR', { style:'currency', currency:'BRL' });
  const $ = s => document.querySelector(s);
  const escapeHTML = (s='') => s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
  const norm = s => (s||'').toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase();

  /* ===== Busca ===== */
  const q = $('#q'), clearBtn = $('#clear');
  function onSearchInput(){ query = norm(q.value.trim()); renderCards(); startAuto(); }
  q.addEventListener('input', onSearchInput);
  clearBtn.onclick = () => { q.value=''; query=''; renderCards(); startAuto(); };

  /* ===== Filtro ===== */
  function filtrados(){
    const qn = query;
    if (!qn) return produtosAll.slice();
    return produtosAll.filter(p=>{
      const hay = norm(`${p.titulo||''} ${p.categoria||''} ${p.descricao||''} ${(p.tags||[]).join(' ')}`);
      return hay.includes(qn);
    });
  }

  /* ===== VIEWER (lightbox) ===== */
  const viewer  = $('#viewer');
  const vImg    = $('#vImg');
  const vPrev   = $('#vPrev');
  const vNext   = $('#vNext');
  const vClose  = $('#vClose');
  const vCount  = $('#vCount');
  let vSources = [];
  let vIdx = 0;

  function vShow(i){
    if (!vSources.length) return;
    vIdx = (i + vSources.length) % vSources.length;
    vImg.src = vSources[vIdx];
    vCount.textContent = vSources.length > 1 ? `${vIdx+1}/${vSources.length}` : '';
    const many = vSources.length > 1;
    vPrev.style.display = many ? 'flex' : 'none';
    vNext.style.display = many ? 'flex' : 'none';
  }
  function openViewer(srcs, start=0){
    vSources = Array.isArray(srcs) && srcs.length ? srcs.slice() : [];
    vShow(start);
    viewer.classList.add('show');
    document.body.style.overflow = 'hidden';
  }
  function closeViewer(){
    viewer.classList.remove('show');
    document.body.style.overflow = '';
  }
  vClose.addEventListener('click', closeViewer);
  vPrev.addEventListener('click', () => vShow(vIdx-1));
  vNext.addEventListener('click', () => vShow(vIdx+1));
  viewer.addEventListener('click', (e)=>{ if(e.target === viewer) closeViewer(); });
  document.addEventListener('keydown', (e)=>{
    if(!viewer.classList.contains('show')) return;
    if(e.key === 'Escape') closeViewer();
    if(e.key === 'ArrowLeft') vShow(vIdx-1);
    if(e.key === 'ArrowRight') vShow(vIdx+1);
  });
  // swipe no viewer
  (function(){
    let sx=null;
    viewer.addEventListener('touchstart', ev=>{ if(!viewer.classList.contains('show')) return; sx = ev.touches[0].clientX; }, {passive:true});
    viewer.addEventListener('touchend', ev=>{
      if(sx==null || !viewer.classList.contains('show')) return;
      const dx = ev.changedTouches[0].clientX - sx;
      if (Math.abs(dx) > 30) { dx<0 ? vShow(vIdx+1) : vShow(vIdx-1); }
      sx = null;
    }, {passive:true});
  })();

  /* ===== Render ===== */
  const track = $('#track'), dots = $('#dots'), empty = $('#empty');

  function renderCards(){
    const lista = filtrados();
    track.innerHTML = '';
    empty.style.display = lista.length ? 'none' : 'block';

    lista.forEach((p, i) => {
      const fotos = Array.isArray(p.fotos) ? p.fotos : [];
      const foto0 = fotos[0] || '';
      const totalFotos = fotos.length;
      const preco = fmt.format(Number(p.preco||0));
      const precoDe = p.precoDe ? fmt.format(Number(p.precoDe)) : null;
      const off = p.precoDe ? Math.max(0, Math.round(100 - (p.preco*100/p.precoDe))) : null;

      const card = document.createElement('article');
      card.className = 'card';
      card.innerHTML = `
        <div class="thumb">
          ${p.selo ? `<span class="badge">${escapeHTML(p.selo)}</span>` : ''}
          <img loading="lazy" src="${foto0}" alt="${escapeHTML(p.titulo||'Produto')}">
          ${totalFotos>1 ? `
            <button class="nav prev" aria-label="foto anterior">‹</button>
            <button class="nav next" aria-label="próxima foto">›</button>
            <span class="counter">1/${totalFotos}</span>
          ` : ''}
        </div>
        <h3>${escapeHTML(p.titulo||'Produto')}</h3>
        <div class="muted">${escapeHTML(p.categoria||'')}</div>
        ${p.descricao ? `<div class="desc">${escapeHTML(p.descricao)}</div>` : ''}
        <div class="row">
          <div>
            <span class="price">${preco}</span>
            ${precoDe ? `<span class="old">${precoDe}</span>` : ''}
            ${off ? `<span class="muted" style="margin-left:6px">-${off}%</span>` : ''}
          </div>
          <button class="btn" data-i="${i}">adicionar à sacola</button>
        </div>
      `;
      track.appendChild(card);

      // Navegação de fotos por card + abrir viewer ao clicar
      const thumb = card.querySelector('.thumb');
      const imgEl = thumb.querySelector('img');
      let idx = 0;

      imgEl.addEventListener('click', (e)=>{
        e.stopPropagation();
        openViewer(fotos, idx);
      });

      if (totalFotos > 1) {
        const prev = thumb.querySelector('.prev');
        const next = thumb.querySelector('.next');
        const counter = thumb.querySelector('.counter');
        const show = (k) => { idx = (k + totalFotos) % totalFotos; imgEl.src = fotos[idx]; if (counter) counter.textContent = `${idx+1}/${totalFotos}`; };
        prev?.addEventListener('click', (e)=>{ e.stopPropagation(); show(idx-1); });
        next?.addEventListener('click', (e)=>{ e.stopPropagation(); show(idx+1); });

        // swipe na imagem (card)
        let startX=null;
        thumb.addEventListener('touchstart', ev => { startX = ev.touches[0].clientX; }, {passive:true});
        thumb.addEventListener('touchend', ev => {
          if(startX==null) return;
          const dx = ev.changedTouches[0].clientX - startX;
          if (Math.abs(dx) > 30) { dx<0 ? show(idx+1) : show(idx-1); }
          startX = null;
        }, {passive:true});
      }
    });

    // botão adicionar
    track.querySelectorAll('.btn').forEach(btn=>{
      btn.onclick = () => addCarrinho(filtrados()[btn.dataset.i]);
    });

    // dots da lista
    const n = Math.max(1, track.children.length);
    dots.innerHTML = Array.from({length:n}, (_,i)=>`<span class="dot${i===0?' active':''}"></span>`).join('');
    updateDots();
  }

  // passo e dots
  function stepSize(){
    const first = track.firstElementChild;
    if(!first) return track.clientHeight;
    const gap = parseFloat(getComputedStyle(track).gap || 14);
    return first.getBoundingClientRect().height + gap;
  }
  function updateDots(){
    if(!track.children.length) return;
    const idx = Math.round(track.scrollTop / stepSize());
    dots.querySelectorAll('.dot').forEach((d,i)=>d.classList.toggle('active', i===idx));
  }
  track.addEventListener('scroll', () => requestAnimationFrame(updateDots), {passive:true});

  /* ===== Auto-slide da lista (vertical) ===== */
  function nextSlide(){
    if(!track.children.length) return;
    const sh = stepSize();
    const maxIdx = track.children.length - 1;
    const curr = Math.round(track.scrollTop / sh);
    const next = curr >= maxIdx ? 0 : curr + 1;
    track.scrollTo({ top: next * sh, behavior:'smooth' });
  }
  function startAuto(){ stopAuto(); if(track.children.length<=1) return; autoTimer = setInterval(nextSlide, AUTO_MS); }
  function stopAuto(){ if(autoTimer){ clearInterval(autoTimer); autoTimer=null; } }
  ['pointerdown','touchstart','mouseenter'].forEach(ev=>track.addEventListener(ev, stopAuto, {passive:true}));
  ['pointerup','touchend','mouseleave'].forEach(ev=>track.addEventListener(ev, startAuto, {passive:true}));
  document.addEventListener('visibilitychange', ()=> document.hidden ? stopAuto() : startAuto());

  /* ===== Carrinho / WhatsApp ===== */
  const bar = $('#bar'), qtdEl = $('#qtd'), totalEl = $('#total');

  // forma de pagamento: monitora os rádios
  document.querySelectorAll('input[name="pg"]').forEach(inp=>{
    inp.addEventListener('change', ()=>{ if(inp.checked) formaPagamento = inp.value; });
  });

  function addCarrinho(p){
    const id = p.id || p.titulo;
    const found = carrinho.find(i=>i.id===id);
    if(found) found.qtd += 1; else carrinho.push({id, titulo:p.titulo, preco:Number(p.preco||0), qtd:1});
    renderBar();
  }
  function renderBar(){
    const qtd = carrinho.reduce((s,i)=>s+i.qtd,0);
    const total = carrinho.reduce((s,i)=>s+i.preco*i.qtd,0);
    qtdEl.textContent = qtd;
    totalEl.textContent = fmt.format(total);
    bar.style.display = qtd ? 'flex' : 'none';
  }
  $('#finalizar').onclick = () => {
    const linhas = carrinho.map(i => `${i.qtd}x ${i.titulo} — ${fmt.format(i.preco)}`).join('\n');
    const total = fmt.format(carrinho.reduce((s,i)=>s+i.preco*i.qtd,0));
    const msg =
      `Olá! Quero finalizar a compra:%0A%0A${encodeURIComponent(linhas)}%0A%0ATotal: ${encodeURIComponent(total)}%0AForma de pagamento: ${encodeURIComponent(formaPagamento)}`;
    window.open(`https://wa.me/${numeroWA}?text=${msg}`, '_blank');
  };

  /* ===== Botão ADM ===== */
  document.getElementById('btnAdm').addEventListener('click', () => {
    if (sessionStorage.getItem('adm_ok') === '1') {
      location.href = 'admin-offline.html';
      return;
    }
    const pwd = prompt('Senha do administrador:');
    if (pwd == null) return;
    if (pwd === "PEDRO1503") {
      sessionStorage.setItem('adm_ok','1');
      location.href = 'admin-offline.html';
    } else {
      alert('Senha incorreta.');
    }
  });

  // start
  renderCards();
  startAuto();
</script>
</body>
</html>
